{{ define "main" }}
<section class="feed-stream">

  {{/* 1. AUTHOR PROFILE CARD (The MD3 Hero - h-card is preserved) */}}
  <article class="h-card profile-card outlined-card md-hero-card" style="margin-bottom: 2rem;">
    
    {{/* Hero Layout Container */}}
    <div class="hero-content-wrapper">
      
      {{/* Image Side */}}
      <div class="hero-avatar-area">
        {{/* p-name is preserved here for h-card compliance */}}
        <h1 class="p-name">{{ .Site.Params.author.name }}</h1>
        {{ $avatar := resources.Get .Site.Params.author.photo }}
        {{ if $avatar }}
          {{ $avatar := $avatar.Fill "500x500 Center webp" }}
          {{/* u-photo is preserved here */}}
          <img class="u-photo" src="{{ $avatar.RelPermalink }}" alt="Profile Photo" width="{{ $avatar.Width }}" height="{{ $avatar.Height }}">
        {{ else }}
          <div class="u-photo-placeholder" style="background:#ccc;width:150px;height:150px;border-radius:50%;">?</div>
        {{ end }}
      </div>

      {{/* Text & Links Side */}}
      <div class="hero-details-area">
        {{/* p-note (bio) is preserved */}}
        <p class="p-note">{{ .Site.Params.author.bio }}</p>

        <div class="profile-meta">
          <span class="p-locality">{{ .Site.Params.author.location.city }}</span>,
          <span class="p-region">{{ .Site.Params.author.location.state }}</span>
        </div>
        
        <h2>Social Media</h2>
        {{/* Social Links rendered as MD3 Assist Chips */}}
        <div class="social-chips-row">
          {{ range .Site.Params.social }}
            {{ partial "ui/social-chip.html" . }}
          {{ end }}
        </div>

        {{ if .Site.Params.im }}
        <h2>Messaging Services</h2>
        <div class="social-chips-row">
          {{ range .Site.Params.im }}
            {{ partial "ui/social-chip.html" . }}
          {{ end }}
        </div>
        {{ end }}
      </div>
      
    </div>
  </article>

  {{/* 2. FEED SECTION TITLE */}}
  <h1>Latest Updates</h1>

  {{/* 3. FEED LOGIC (h-entry is preserved on <article> below) */}}
  {{ $allowed_sections := slice "articles" "status" "replies" "reposts" "likes" "bookmarks" "rsvps" }}
  {{ $feed := where .Site.RegularPages "Section" "in" $allowed_sections }}
  {{ $paginator := .Paginate $feed }}

  <div class="post-feed">
    {{ range $paginator.Pages }}
      {{/* MICROFORMAT CHECK: h-entry is preserved here */}}
      <article class="feed-item outlined-card h-entry {{ .Type }}">
        <header class="feed-header">
          <div class="headline-row">
            {{ partial "ui/chip.html" . }}
            <h2 class="p-name"><a href="{{ .Permalink }}" class="u-url">{{ .Title }}</a></h2>
          </div>
          <time class="dt-published" datetime="{{ .Date.Format "2006-01-02T15:04:05Z07:00" }}">
            {{ .Date.Format "Jan 02, 2006" }}
          </time>
        </header>
        <div class="feed-content p-summary">
          {{ if .Params.summary }}{{ .Params.summary }}{{ else }}{{ .Content | plainify | truncate 500 }}{{ end }}
        </div>
        <a href="{{ .Permalink }}" class="u-url">Read More</a>
      </article>
    {{ else }}
      <div class="outlined-card">
        <h3>No updates found.</h3>
        <p>The stream is currently quiet.</p>
      </div>
    {{ end }}
  </div>

  {{ template "_internal/pagination.html" . }}
</section>
{{ end }}
