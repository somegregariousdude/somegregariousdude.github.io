{{ define "main" }}
<article class="single-post h-entry outlined-card">
  
  {{/* MICROFORMATS: Hidden Author Block */}}
  <div style="display: none;" class="p-author h-card">
    <a href="{{ .Site.BaseURL }}" class="u-url p-name">{{ .Site.Params.author.name }}</a>
    <img src="{{ .Site.Params.author.photo | absURL }}" class="u-photo" alt="{{ .Site.Params.author.name }}">
  </div>

  <header class="post-header">
    <div class="headline-row">
      {{ partial "ui/chip.html" . }}
      <h1 class="p-name">{{ .Title }}</h1>
    </div>
    
    {{/* ENHANCED METADATA ROW */}}
    <div class="post-meta">
      <div class="meta-item">
        <span class="meta-icon">{{ partial "icons/event.svg" . }}</span>
        <div class="meta-text">
          <time class="dt-published" datetime="{{ .Date.Format "2006-01-02T15:04:05Z07:00" }}">
            {{ .Date.Format "Monday, Jan 2, 2006 at 3:04 PM (MST)" }}
          </time>
          {{ if ne .Date .Lastmod }}
          <span class="dt-updated-label">
            (Updated: <time class="dt-updated" datetime="{{ .Lastmod.Format "2006-01-02T15:04:05Z07:00" }}">{{ .Lastmod.Format "Jan 2, 2006" }}</time>)
          </span>
          {{ end }}
        </div>
      </div>

      <div class="meta-item">
        <span class="meta-icon">{{ partial "icons/schedule.svg" . }}</span>
        <span class="reading-time">{{ .ReadingTime }} min read</span>
      </div>
    </div>
  </header>

  {{/* CONTEXT BLOCKS (Reply, Like, etc.) */}}
  {{ if .Params.reply_to }}<div class="context-block reply-context"><p>Replying to: <a href="{{ .Params.reply_to }}" class="u-in-reply-to">{{ .Params.reply_to }}</a></p></div>{{ end }}
  {{ if .Params.like_of }}<div class="context-block like-context"><p>Liked: <a href="{{ .Params.like_of }}" class="u-like-of">{{ .Params.like_of }}</a></p></div>{{ end }}
  {{ if .Params.repost_of }}<div class="context-block repost-context"><p>Reposted: <a href="{{ .Params.repost_of }}" class="u-repost-of">{{ .Params.repost_of }}</a></p></div>{{ end }}
  {{ if .Params.bookmark_of }}<div class="context-block bookmark-context"><p>Bookmarked: <a href="{{ .Params.bookmark_of }}" class="u-bookmark-of">{{ .Params.bookmark_of }}</a></p></div>{{ end }}
  {{ if and .Params.rsvp .Params.reply_to }}<div class="context-block rsvp-context"><p>RSVP: <span class="p-rsvp">{{ .Params.rsvp | upper }}</span> to <a href="{{ .Params.reply_to }}" class="u-in-reply-to">{{ .Params.reply_to }}</a></p></div>{{ end }}

  <div class="e-content">{{ .Content }}</div>

  <footer class="post-footer">
    {{ if .Params.syndication }}
    <div class="syndication-container">
      <span class="syndication-label">Also on:</span>
      <div class="syndication-chips" style="display: inline-flex; flex-wrap: wrap; gap: 8px; margin-top: 8px;">
        {{ range .Params.syndication }}
          {{ $synURL := . }}
          {{ $match := false }}
          {{ $data := dict }}
          {{ range $.Site.Params.social }}
             {{ if in $synURL .url }}
               {{ $match = true }}
               {{ $data = . }}
             {{ end }}
          {{ end }}
          <a href="{{ $synURL }}" class="chip u-syndication" rel="syndication" style="text-decoration: none;">
            {{ if $match }}
               {{ if $data.icon }}<span class="chip-icon" aria-hidden="true" style="color: var(--md-sys-color-primary);">{{ partial (printf "icons/%s.svg" $data.icon) . }}</span>{{ end }}
               <span class="chip-label">{{ $data.name }}</span>
            {{ else }}
               <span class="chip-label">{{ replaceRE "^https?://([^/]+).*" "$1" $synURL }}</span>
            {{ end }}
          </a>
        {{ end }}
      </div>
    </div>
    {{ end }}

    {{ if .Params.tags }}
    <ul class="tags">{{ range .Params.tags }}<li><a href="{{ "/tags/" | relLangURL }}{{ . | urlize }}" class="p-category">#{{ . }}</a></li>{{ end }}</ul>
    {{ end }}
  </footer>
</article>

{{ partial "share-buttons.html" . }}

{{ if .Params.show_webmentions }}
<section id="webmentions" class="webmentions-container outlined-card" data-target="{{ .Permalink }}" aria-labelledby="mentions-heading">
  <div class="webmention-header">
    <h2 id="mentions-heading">Webmentions</h2>
    
    {{/* COPYABLE URL COMPONENT */}}
    <div class="webmention-copy-field">
      <span class="url-text">{{ .Permalink }}</span>
      <button class="copy-btn icon-btn" data-clipboard-text="{{ .Permalink }}" aria-label="Copy Webmention URL">
        {{ partial "icons/content_copy.svg" . }}
      </button>
    </div>
  </div>
  
  <div class="webmention-explainer">
    <p>Have your say. Write a post on your own site and link to this URL to appear here!</p>
  </div>

  <div id="webmentions-list"><p>Loading...</p></div>
</section>
{{ end }}
{{ end }}
